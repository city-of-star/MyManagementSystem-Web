## MyManagementSystem-Web 前端配置与环境说明

本文档说明当前项目的「环境配置」「应用配置」「请求封装」方案，以及后续如何逐步演进。你可以把它当作你自己项目的最佳实践笔记。

### 安装依赖
- 路由、状态管理、HTTP 请求             npm install vue-router pinia axios
- UI 组件库 + 图标                    npm install element-plus @element-plus/icons-vue
- 图表 + 顶部进度条                    npm install echarts nprogress
- SCSS 支持（开发依赖）                npm install --save-dev sass
- 富文本编辑器                        npm install @vueup/vue-quill quill

---

### 一、整体设计思路

当前前端用的是 **Vite + Vue3 + TypeScript**，我们把配置拆成三层：

- **环境级配置（Environment）**：和运行环境强相关的内容  
  例如：后端网关地址、本地开发 vs 生产服务器。  
  ➜ 使用 Vite 的 `.env.*` 文件，通过 `import.meta.env` 读取。

- **应用级配置（App）**：描述这个管理系统“长什么样”  
  例如：系统标题、logo、主题色、水印开关。  
  ➜ 使用 TypeScript 模块 `src/config/appConfig.ts` 管理。

- **请求封装（Request）**：统一管理接口调用细节  
  例如：基地址拼接、接口前缀、统一错误处理、后续的 token 处理。  
  ➜ 使用 `src/utils/request.ts`。

这种拆法的目标是：**清晰、可维护、方便后续加新功能**。

---

### 二、环境级配置：`.env.development` / `.env.production`

当前在项目根目录（和 `package.json` 同级）有两个文件：

- `.env.development`：本地开发使用，配合 `npm run dev`
- `.env.production`：打包上线使用，配合 `npm run build`

示例内容（开发环境）：

```bash
VITE_API_BASE_URL=""
VITE_API_PREFIX="/usercenter"
VITE_ENABLE_MOCK="false"
```

说明：

- **`VITE_API_BASE_URL`**
  - 开发环境设置为空字符串 `""`，表示前端只使用相对路径，请求交给 Vite 代理去转发到后端。
  - 生产环境可以填写你的服务器网关地址，例如：`http://你的服务器IP或域名:网关端口`。

- **`VITE_API_PREFIX`**
  - 当前前端主要对接用户中心服务，网关通过 `/usercenter/**` 路由到 `usercenter` 微服务，所以这里设置为 `/usercenter`。

在代码中，可以通过 `import.meta.env.VITE_XXX` 访问这些变量，例如：

```ts
console.log(import.meta.env.VITE_API_BASE_URL)
console.log(import.meta.env.VITE_API_PREFIX)
```

> 注意：修改 `.env.*` 文件后，需要重新执行一次 `npm run dev`，Vite 才会重新加载环境变量。

---

### 三、应用级配置：`src/config/appConfig.ts`

这个文件负责描述“应用长什么样”，例如标题、logo、主题色等：

```ts
export interface AppConfig {
  version: string
  title: string
  logoPath: string
  waterMark: boolean
  themeColors: string[]
  defaultThemeColor: string
}

export const appConfig: AppConfig = {
  version: 'v1.0.0',
  title: 'My Management System',
  logoPath: '/mms.svg',
  waterMark: false,
  themeColors: ['#007aff', '#1aa97b', '#ff4d53'],
  defaultThemeColor: '#0085d0',
}
```

使用方式（示例）：

```ts
import { appConfig } from '../config/appConfig'

console.log(appConfig.title)
```

后续你可以在这里继续增加前端相关配置，例如：

- 登录页副标题、版权信息；
- 是否开启水印、默认水印内容；
- 布局类型（侧边菜单 / 顶部菜单）；
- 校验规则（密码、邮箱、手机号等）。

这些都属于“前端自身的产品配置”，推荐放在 `appConfig` 中，用 TypeScript 管理，而不是挂到 `window`。

---

### 四、请求封装：`src/utils/request.ts`

这个文件负责统一管理接口请求逻辑，目前是一个简单的 `fetch` 封装：

```ts
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL as string
const API_PREFIX = import.meta.env.VITE_API_PREFIX as string | undefined

function buildUrl(path: string): string {
  const prefix = API_PREFIX ?? ''
  // 如果 BASE_URL 为空，就只返回相对路径，交给 Vite 代理处理
  if (!API_BASE_URL) {
    return `${prefix}${path}`          // 结果：/usercenter/auth/login
  }
  return `${API_BASE_URL}${prefix}${path}` // 结果：http://localhost:5092/usercenter/auth/login
}
```

结合 `.env`：

- **开发环境（`VITE_API_BASE_URL=""`）**
  - `buildUrl('/auth/login')` → `/usercenter/auth/login`
  - Vite dev server 看到以 `/usercenter` 开头的请求，根据 `vite.config.ts` 中的代理配置，自动转发到 `http://localhost:5092/usercenter/auth/login`，从而避免浏览器跨域问题。

- **生产环境（`VITE_API_BASE_URL="http://你的服务器"`）**
  - `buildUrl('/auth/login')` → `http://你的服务器/usercenter/auth/login`

请求函数：

```ts
export interface HttpResponse<T = unknown> {
  code: number
  msg: string
  data: T
}

export async function httpPost<T = unknown>(path: string, body?: unknown): Promise<HttpResponse<T>> {
  const url = buildUrl(path)

  const resp = await fetch(url, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      // 后续可以在这里统一加 Authorization: `Bearer ${token}`
    },
    body: body ? JSON.stringify(body) : undefined,
  })

  if (!resp.ok) {
    throw new Error(`请求失败: ${resp.status}`)
  }

  return resp.json()
}
```

登录接口的封装示例：

```ts
export interface LoginRequest {
  username: string
  password: string
}

export interface LoginVo {
  accessToken: string
  refreshToken: string
  // 可以根据后端 LoginVo 继续补充字段
}

export function loginApi(payload: LoginRequest) {
  return httpPost<LoginVo>('/auth/login', payload)
}
```

**后续扩展建议：**

- 增加 `httpGet`、`httpPut`、`httpDelete` 等方法；
- 在这里集中处理：
  - 401 未登录 / token 过期时的跳转逻辑；
  - 全局错误提示（比如配合 Element Plus 的 `ElMessage`）；
  - 自动携带 `Authorization: Bearer accessToken` 头。

---

### 五、开发环境代理：`vite.config.ts`

当前 `vite.config.ts` 中配置了一个简单的开发环境代理：

```ts
export default defineConfig({
  plugins: [vue()],
  server: {
    proxy: {
      // 开发环境：将 /usercenter 代理到本地网关，避免浏览器跨域问题
      '/usercenter': {
        target: 'http://localhost:5092',
        changeOrigin: true,
      },
    },
  },
})
```

作用：

- 浏览器实际上只看到对 `http://localhost:5173/usercenter/...` 的请求（同源）；
- Vite dev server 在后台帮你把请求转发到 `http://localhost:5092/usercenter/...`；
- 前端无需关心 `CORS` 细节，专注写业务代码即可。

> 生产环境下，一般会通过 Nginx 或网关统一反向代理，这部分可以等你真正部署到服务器时再配置。

---

### 六、下一步可以如何改造和演进？

目前这套配置是一个「干净的最小骨架」，接下来可以按下面的顺序逐步增强：

#### 1. 登录页面和 token 管理

- 新建一个 `Login.vue` 页面（用户名/密码表单 + 表单校验）；
- 使用 `loginApi` 调用后端登录接口；
- 登录成功后：
  - 将 `accessToken`、`refreshToken` 存到 `localStorage` 或 `sessionStorage`；
  - 在 `request.ts` 中读取 token，并在请求头中统一加上 `Authorization`。

#### 2. 抽象认证模块

- 新建 `src/modules/auth` 或 `src/store/auth`：
  - 负责保存当前用户信息、token、登录状态；
  - 提供 `login`、`logout`、`refreshToken` 等方法。
- 在路由守卫中检查：
  - 未登录访问受保护页面时自动跳到登录页；
  - 登录后不能再访问登录页。

#### 3. 菜单 / 路由与后端权限联动

- 按业务模块拆分路由文件，例如：
  - `src/router/modules/system.ts`（系统管理：用户、角色、菜单、参数）；
- 后期可以考虑：
  - 登录后从后端获取当前用户的菜单树；
  - 根据菜单动态生成路由和侧边栏菜单。

#### 4. 丰富应用配置

- 在 `appConfig` 中逐步加入：
  - 页面标题、副标题、版权文字；
  - 主题切换（多套主题色）；
  - 是否开启水印、默认水印内容；
  - 登录页展示文案等。
- 如果未来有需求，可以再增加一层「可运行时覆盖的配置」：
  - 例如通过 `public/config.js` 或后端接口下发配置，覆盖 `appConfig` 的部分字段。

---

### 七、总结

当前项目已经具备了：

- 基于 Vite 官方机制的 **多环境配置**（`.env.*` + `import.meta.env`）；
- 清晰的 **应用级配置位点**（`src/config/appConfig.ts`）；
- 可扩展的 **请求封装入口**（`src/utils/request.ts`）；
- 解决开发阶段跨域问题的 **Vite 代理配置**。

这是一套比较符合现代前端工程实践的基础结构，你后续只需要在这套骨架上：

- 往 `appConfig` 里补业务相关配置；
- 在 `request.ts` 里增强 token、错误处理等横切逻辑；
- 在 `modules` 中逐步实现「用户管理 / 角色管理 / 菜单管理 / 参数管理」页面即可。

你可以把这份文档当成自己项目的“前端配置说明书”，后面如果有新增约定或改造，也可以继续在这里补充。 


